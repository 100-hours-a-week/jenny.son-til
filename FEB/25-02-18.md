# TIL 

## 날짜: 2025-02-18

### 스크럼
- 학습 목표 1 : 웹소켓 학습하기

### 새로 배운 내용
#### 📍 주제 1: 웹소켓이란? 
- ** 웹 애플리케이션과 서버 간의 실시간 양방향의 지속적인 연결을 제공하는 프로토콜.**
- 다음과 같은 특징을 가진다.
  1. **실시간 데이터 전송**
  2. **연결 유지 비용 절감**
  3. **양방향 통신**
  4. **메시지 경계 존중**
- `7계층` 프로토콜이며, `tcp 기반`이다.
- 3-way handshake로 tcp 연결이 이루어진 다음, `웹소캣 연결`, `데이터 송수신`, `연결 해제` 과정으로 이루어진다. 웹소캣 레이어에서 연결이 해제되면 4-way handshake로 tcp 연결이 해제된다. 
- 데이터의 전송 단위는 `프레임`이다. 프레임은 TCP 세그먼트 위에서 동작하는 데이터 단위이며, 프레임 단위로 메시지를 쪼개어 전송할 수 있다. 

#### 📍 주제 2: 웹소켓 동작 과정
1. **`웹소켓 연결`** <br/>
  i. 클라이언트가 웹서버와 웹소켓 연결을 설정할 때 `ws://` , `wss://` 프로토콜을 사용한다.<br/>
  ii. 클라이언트가 요청을 보내면, 서버는 요청을 받아들이고 `101 Switching Protocols` 응답을 반환하며 연결을 유지한다. <br/>
2. **`데이터 송수신`**<br/>
  i. 연결된 소켓 객체를 통해 `양방향 통신`이 이루어진다.<br/>
  ii. 연결 이후에는 클라이언트와 서버가 **계속 연결되어 있는 상태**이므로, 소켓 객체를 이용해 서버와 클라이언트가 **요청/응답 없이 데이터를 송수신**한다.<br/>
  iii. 데이터를 보내는 단위는 프레임이다. <br/>
3. **`연결 종료`**<br/>
  i. 연결을 해제할 때도 소켓 객체를 이용해 요청한다.<br/>
  ii. 연결을 종료하기 위해 특별한 프레임을 전송하는 것! `Close 프레임` 이라고 한다.<br/>
  iii. Close 프레임은 연결이 정상적으로 종료되었음을 알리고, 종료 코드와 종료 이유(텍스트)를 포함할 수 있다. <br/>

#### 📍 주제 3: ws와 wss의 차이점 
- `ws`는 HTTP 기반의 `비암호화` 통신, `wss`는 HTTPS 기반의 `암호화` 통신이다.
- 클라이언트가 웹서버와 웹소켓 연결을 설정할 때 ws:// , wss:// 프로토콜을 사용한다. <br/>
  연결이 설정된 이후에는 ws/wss 프로토콜이 필요하지 않으며, `연결된 웹소켓 객체`를 통해서 데이터 송수신, 연결 종료가 이루어진다. 

#### 📍 주제 4: 메시지 프레임과 경계
- 각 `프레임`은 `메시지`의 조각이며, 프레임 헤더의 `FIN` 비트를 통해 메시지의 시작과 끝을 나타낼 수 있다.

#### 📍 주제 5: 클로즈 프레임의 역할
- `클로즈 프레임`은 **웹소켓 통신에서 `연결 해제`를 알리기 위한 프레임**(데이터 전송 단위)이다.
- 웹소켓 통신에서는 연결 설정 후 프레임 단위로 데이터를 송수신한다. <br/>
서버나 클라이언트가 연결을 해제하고 싶을 때, 특별한 프레임을 보내 연결 종료를 알리고 응답하는데, 이를 Close 프레임이라 한다. <br/>
연결 해제 시 Close 프레임을 사용해 종료 상태와 이유를 전달할 수 있다. <br/>

### 오늘의 도전 과제와 해결 방법
- 도전 과제 1: 웹소켓 연결 및 동작 방식 이해하기
  - 웹소켓 헤더의 FIN과 Opcode, TCP 헤더의 FIN 이해
  - 웹소켓 프레임이 tcp 세그먼트로 감싸지는 것을 이해함
  - 전송 계층마다 연결 설정/종료 과정이 각각 이루어진다는 것을 알게됨.
  - 웹소켓의 클로즈 프레임으로 7계층 연결이 종료된 후 tcp의 fin 세그먼트를 통해 4계층 연결이 4way handshake로 종료됨. 

### 오늘의 회고
- 팀원 분께서 웹소켓 연결 종료 과정 중 tcp 4-way handshake 과정을 설명해주셨다. 이 과정에서 tcp의 fin 헤더와 웹소켓의 fin 헤더가 같은 것인지, 클로즈프레임 교환과 tcp 연결해제 과정이 동시에 수행되는 것인지에 대한 개념이 안 잡혀있어 팀원 간에 이야기를 하게 되었다. 논의하는 과정을 통해 어떤 것을 모르고 있는지 알게 되었고, 궁금한 질문을 해결하는 과정을 통해 연결 해제 과정을 정확히 이해하게 되었다. 특히, 레이어 별로 연결 설정/해제가 따로 진행된다는 것이 큰 깨달음이었다. 그리고 웹소켓 프레임이 tcp 세그먼트로 감싸진다는 것 또한 큰 알게됨이었다. 

### 참고 자료 및 링크
- [노션 정리 😎](https://mellow-sailor-ec6.notion.site/19e258f8f6198091bc55eb3c2551cccd?pvs=4)
