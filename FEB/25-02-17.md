# TIL 

## 날짜: 2025-02-17

### 스크럼
- 학습 목표 1 : 쿠키, 세션, 스토리지 학습하기 

### 새로 배운 내용
#### 주제 1: 쿠키 🍪
- `쿠키`는 **웹 브라우저에 저장되는 작은 데이터 조각으로, HTTP 요청 시 자동으로 서버로 전송된다.**
- HTTP는 Stateless(무상태) 프로토콜이므로, 서버는 클라이언트의 이전 요청 상태를 저장하지 않는다.
  이를 보완하기 위해 쿠키를 활용하여 사용자 세션 및 인증 정보를 유지할 수 있다.
- 쿠키는 사용자가 방문한 웹사이트에서 설정하는 `퍼스트파티 쿠키`(First-Party Cookie)와,
  광고 네트워크나 분석 서비스 등 제3자가 설정하는 `서드파티 쿠키`(Third-Party Cookie)로 구분된다.
- 서버는 `Set-Cookie` 헤더를 통해 쿠키를 설정하며, 이후 클라이언트가 해당 서버에 요청을 보낼 때 자동으로 쿠키를 포함하여 보냄으로써, **서버가 사용자의 이전 요청 정보를 기억하고, 로그인 상태 유지, 세션 관리, 개인화된 서비스 제공이 가능해진다.**
  ```java
  HTTP/1.1 200 OK
  Set-Cookie: session_id=abc123; Path=/; HttpOnly; Secure; SameSite=Strict; Max-Age=3600
  // 쿠키 아이디, 전송될 경로, 옵션(HttpOnly, Secure, SameSite=Strict), 유효 기간
  ```
  <img width="656" alt="image" src="https://github.com/user-attachments/assets/21919652-cf0f-49ef-905e-3b826fc2e90a" />
- 쿠키의 속성 <br/>
  - `HttpOnly`: js를 통한 쿠키 접근을 차단하고, http통신을 통해서만 쿠키를 주고받을 수 있다. XSS 공격으로부터 쿠키를 보호.
  - `Secure`: HTTPS 프로토콜 상에서 암호화된 요청일 경우에만 전송한다. MITM로부터 쿠키를 보호.
  - `SameSite`: 크로스 사이트 요청 범위를 제한한다. CSRF 공격을 방지하기 위해, 쿠키가 퍼스트파티에서만 전송되도록 제한하는 용도로 사용한다. `Strict`, `Lax`, `None` 옵션이 있으며, Chrome 브라우저의 기본 설정은 Lax 이다. 
  - 유효 기간: `Expire` 또는 `Max-Age`를 이용해 설정한다. 유효기간이 명시된 쿠키를 `Persistent Cookie`, 그렇지 않은 쿠키를 `Session Cookie`라고 한다. 세션 쿠키는 브라우저 종료와 함께 삭제된다.   

#### 주제 2: 세션 🧶
- `세션`은 **사용자가 웹사이트를 방문하는 동안 서버 또는 클라이언트에서 유지되는 상태 정보**를 말한다.
  사용자가 특정 페이지에서 다른 페이지로 이동할 때 **이전 상태를 유지하는 방법.**
- 서버에서 세션 데이터를 저장하고, 클라이언트는 세션 ID(session_id)를 쿠키로 전달하여 세션을 유지한다. (ex. 로그인 유지, 장바구니 저장)
- 세션은 일반적으로 서버 측에서 관리되지만, 클라이언트 측에서도 `sessionStorage`를 통해 관리될 수 있다. (ex. 사용자가 입력한 폼 데이터 유지)
- 세션과 쿠키를 함께 사용한다. 
  - **웹 브라우저 쿠키에는 세션 id를 저장.**
  - **서버에 세션id와 함께 세션 관련 정보 저장. 클라이언트 요청 시 전달되는 세션 id를 조회하여 맞게 처리한다.**
- 세션은 서버 메모리, 파일 스토리지, 데이터베이스에 저장할 수 있다. 
  현업에서는 서버에서 세션 저장을 위해 **redis**를 많이 사용한다. api 요청마다 세션 조회가 필요하기 때문에 빠른 처리 속도가 중요하기 때문.

#### 주제 3: 스토리지 📀
- `스토리지`는 **웹 브라우저의 저장소**이다. 데이터를 안전하게 보관하고 언제든지 쉽게 찾아서 사용할 수 있도록 하기 위해 사용함. 
- js에서 localStorage 객체로 저장. key, value 형태.
- 로컬 스토리지와 세션 스토리지
  - `로컬 스토리지`는 디스크에 저장되며 브라우저 종료 후에도 남아 있다.
  - `세션 스토리지`는 RAM에 저장되며 브라우저 종료와 함께 삭제된다.
- 쿠키 vs. 스토리지
  - 쿠키는 HTTP 요청과 함께 자동으로 서버로 전송되는 데이터이고, 웹 스토리지는 브라우저 내부에서만 사용되는 별도의 저장 공간이다.
  - 쿠키 → 사용자 인증, 세션 관리, 서버와 자동 동기화 (ex. 로그인 유지)
  - 웹 스토리지 → 대량의 클라이언트 측 데이터 저장, 빠른 접근 (ex. 테마 설정, 임시 데이터 저장)
  - **쿠키는 서버와의 통신을 위해 존재하며, 웹 스토리지는 클라이언트 측에서 데이터를 유지하기 위한 용도로 사용된다.**

### 오늘의 도전 과제와 해결 방법
- 도전 과제 1: 쿠키의 단점 중 네트워크 과부하를 해결하는 방법에 대해 팀원들과 이야기하던 중, 세션 쿠키가 아닌 jwt를 이용한 인증 방식에 대한 이야기가 나왔다. jwt를 쿠키에 저장하지 않는다면, jwt를 Authentication 헤더에 담아 필요한 경우에만 전송하므로써 네트워크 부하를 줄일 수 있다. jwt를 쿠키에 저장한다면 매 요청마다 자동으로 보내지므로 차이가 없다. 따라서 jwt의 저장 방법에 대해서 더 알아보게 되었다.
  #### JWT 저장 위치
  (1) 메모리(변수, 상태관리) 저장 (가장 안전)
  - 클라이언트의 메모리(RAM) 또는 프론트엔드 상태 관리(store)에 JWT를 저장하는 방식 
  - XSS 공격으로부터 안전 (JavaScript가 접근할 수 없으므로 유출 위험 적음)
  - 새로고침(F5)하면 데이터가 사라짐 (새로고침 후 로그인 필요)
  - SPA(Single Page Application)에서 가장 추천되는 방식
  
  (2) 쿠키(Cookie) 저장 (보안 강화 가능)
  - JWT를 HttpOnly 속성이 설정된 쿠키에 저장하여 보안성을 강화하는 방식
  - OAuth 기반 인증(예: Google 로그인)에서 자주 사용됨
  
  (3) 웹 스토리지(LocalStorage, SessionStorage) 저장 (편리하지만 보안 취약)
  - JWT를 localStorage 또는 sessionStorage에 저장하여 쉽게 접근하는 방식 
  - 새로고침해도 데이터 유지 (localStorage)
  - XSS 공격에 취약 (공격자가 localStorage.getItem('jwt')을 통해 탈취 가능)
  - sessionStorage는 브라우저 종료 시 사라짐
  - 보안이 중요한 서비스(은행, 결제 시스템)에서는 권장되지 않음!

### 오늘의 회고
- 쿠키, 세션, 스토리지는 헷갈리는 개념이었는데, 셋의 차이점을 이해하고 각각 언제 왜 쓰는지, 어떤 경우에 사용하는 것이 적합한지 알게 되었다.

### 참고 자료 및 링크
- [노션](https://mellow-sailor-ec6.notion.site/19d258f8f619808f9ae2ff9102558688?pvs=4)
