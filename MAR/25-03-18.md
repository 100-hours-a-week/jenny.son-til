# TIL 

## 날짜: 25-03-18

### 스크럼
- 학습 목표 1 : JPA와 ORM 이해
- 학습 목표 2 : JPA 동작 원리 이해 - 엔티티 매니저와 영속성 컨텍스트 

### 요약
1. JPA가 ORM을 구현하는 방법 - 다음을 표준화한다: 엔티티 테이블 간 매핑 규칙, 영속성 컨텍스트, 트랜젝션/쿼리 처리 방식.
2. ORM 이점과 한계 - 대량 데이터 처리와 복잡한 연산 시 성능 문제 가능.
3. 엔티티와 영속성 컨텍스트 관계 - 1차 캐시, 더티 체킹, 레이지 로딩 중요.
4. 엔티티 생명주기 - 준영속 중요
5. 지연로딩과 즉시로딩 차이 - 연관된 엔티티를 언제 가져오는지.

### 새로 배운 내용
#### 🌼 주제 1: JPA와 ORM 이해
- **JPA(Java Persistence API)란?** Java 플랫폼을 위한 ORM(객체-관계 매핑) 기술 표준.
  - **데이터베이스 테이블을 자바의 객체로 매핑하여 다루도록 해준다.**
  - **인터페이스**로만 구성되어 있으며, 실제 **구현체(Hibernate)** 를 통해 동작한다.
  - 스프링부트와 함께 Spring Data JPA를 많이 많이 사용한다. 
- **ORM(Object Relational Mapping)이란?** 객체와 데이터베이스 테이블을 연결하여, 객체지향 언어와 관계형 DB의 패러다임 불일치를 해결하는 기술.
  - JPA가 다음을 표준화함으로써 ORM을 구현한다: 엔티티 테이블 간 매핑 규칙(@Entity, @Table, @Id), 영속성 컨텍스트 개념, 트랜잭션/쿼리 처리
  - ORM 이점: SQL 작성 감소, 생산성, 유지보수성, 객체지향 설계
  - ORM 한계: 대량 데이터 처리, 복잡한 연산의 경우 성능 문제가 발생할 수 있다.
    - Why?
        1. 대량 데이터 처리 - 기본적으로 엔티티 단위로 1개씩 INSERT/UPDATE 처리한다. 10000개의 데이터를 저장할 경우 SQL도 10000번 실행된다. 
        2. 대량 데이터 처리 - 또한, 조회한 데이터를 엔티티 객체로 변환해 1차 캐시에 저장한다. 대량 데이터를 조회하면 메모리에 과부하가 발생할 수 있다.
        3. 복잡한 쿼리 - Join이 많을 때 비효율적이다. 불필요한 추가 쿼리(N+1문제) 발생 가능
        4. 복잡한 쿼리 - ORM은 단순 CRUD에는 강하지만, 복잡한 집계 연산(sum, cound, group by)은 최적화가 어렵다.

#### 🌼 주제 2: 엔티티 매니저와 영속성 컨텍스트
- 엔티티와 영속성 컨텍스트
  - **엔티티**란 디비 테이블의 한 행을 객체로 매핑한 것이다.
  - **영속성 컨텍스트**란 엔티티를 영구적으로 저장하고 관리하는 가상의 공간이다. (JPA에서 엔티티 객체를 관리하는 핵심 메커니즘!)
- 영속성 컨텍스트의 기능 ~ 엔티티가 영속성 컨텍스트에 등록되면
  - 1. **1차 캐시**: 동일 트랜잭션 내에서 같은 pk 조회 시 디비 대신 캐시를 사용한다.
  - 2. **변경 감지(Dirty Checking)**: 엔티티 변경 사항을 자동으로 감지하고 트랜잭션이 커밋되는 시점에 엔티티를 찾아 UPDATE를 자동 생성한다.
    - "Dirty"는 기존의 상태(Clean)에서 변경(Dirty)되었다는 것을 의미한다.
  - 3. **지연 로딩(Lazy Loading)**: 연관관계에 있는 엔티티를 필요 시점에 디비로부터 로딩한다.
  - 영속성 컨텍스트는 트랜잭션 범위 내에서 동작한다. 
- 엔티티 생명주기: 영속성 컨텍스트 동작 안에서 엔티티는 비영속/영속/준영성/삭제의 상태를 거친다.
  1. 비영속
  2. 영속
  3. 준영속
  4. 삭제
- 엔티티 매니저와 영속성 컨텍스트의 관계
  - **엔티티 매니저**란 JPA의 핵심 API로, 엔티티를 영속성 컨텍스트에 등록하거나 조회,수정,삭제 등 디비 작업을 수행하는 객체이다.
  - **엔티티 매니저는 내부적으로 영속성 컨텍스트를 관리하고, 이를 통해 엔티티의 상태와 생명주기를 제어한다.**

### 오늘의 회고
- 스프링과 JPA 실습과 함께 JPA 주요 어노테이션과 ORM에 대해 이해할 수 있었다. 엔티티 생명주기 이해를 통해 엔티티를 언제 디비에 반영할지, 언제 다시 디비에 반영이 안 되는지를 명확히 이해할 수 있다. 이 부분에 대해서 과제를 진행하면서 노트로 정리하면서 엔티티 생명주기에 대해 더 제대로 이해해야겠다. 

### 참고 자료 및 링크
- 
